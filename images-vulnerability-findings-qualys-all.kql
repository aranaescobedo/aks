SecurityResources
| where type =~ "microsoft.security/assessments/subassessments" and id has "dbd0cb49-b563-45e7-9724-889e799fa648" //the ID of the assessment - Container registry images should have vulnerability findings resolved (powered by Qualys)
|  extend
    status = properties.status.code,
    severity = tostring(properties.status.severity),
    repoName = properties.additionalData.repositoryName
| where
    status == "Unhealthy" //and repoName contains "<ADD_YOUR_REPO_NAME_TO_FILTER>"
| extend
     crName = properties.additionalData.registryHost,
     high = iff(severity == "High", 3,0), medium = iff(severity == "Medium", 2, 0), low = iff(severity == "Low", 1 ,0),
     lastModified = todatetime(properties.timeGenerated)
| extend all = high + medium + low, lastModifiedDate = format_datetime(lastModified, 'yyyy-MM-dd')
| order by all desc, lastModifiedDate
| project ACRName = split(crName,".")[0],
     RepositoryName = repoName,
     ImageDigest = properties.additionalData.imageDigest,
     LastModified = lastModifiedDate,
     Severity = severity,
     Name = properties.displayName,
     Description = properties.description,
     Impact = properties.impact,
     Remediation = properties.remediation,
     CVECode = properties.additionalData.cve[0]["title"]
